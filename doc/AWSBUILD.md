AWS Build Machine
=================

This document describes the procedure I used for creating "production" Linux
images for experiments. The result of this is a debian package built for Ubuntu.
The configuration I create is based on the normal Ubuntu 14.02 config, but with
the appropriate configuration items from my fragment files applied. You don't
need to do this in AWS, but I did it (so I could be compiling or doing other
things on my machine). So this guide assumes you're doing it on AWS.

Machine Setup
-------------

Since I needed a Ubuntu machine to build debian kernel packages, I got an AWS
instance. Here's the script to get started:

    # packages (run on build machine)
    sudo apt update
    sudo apt upgrade
    sudo apt install build-essential git kernel-package fakeroot \
        libncurses5-dev libssl-dev ccache

    # Get code (run on build machine)
    # (1) get the MPTCP repository from GitHub
    # (2) alternatively, apply the path-manager patch to the v0.91 source tree
    git clone -b dynamic_detour --single-branch --depth 16 \
        https://github.com/brenns10/mptcp.git

    # Copy a kernel config from your machine (modify to suit your needs)
    scp ~/repos/mptcp/.config AWS:mptcp/

    # Compile the kernel! (run on build machine)
    make oldconfig  # just to be sure
    make -j 3 deb-pkg LOCALVERSION=-custom

The output files will be placed one level up from the source directory. They
will be deb files.

Kernel Config
-------------

You will need a kernel config, which is the `ubuntu_custom` one from the `etc/`
directory. It can be generated by merging the default Ubuntu kernel config with
some (but not all) of the fragments in the `etc/` directory. In particular, we
want these:

- `mininet.frag`
- `mptcp.frag`

The other ones are not necessary because we don't want to have any debugging
options in use for testing, and since we aren't using vido, we won't need the
special overlay filesystem stuff. Here's a copy paste command from `mptcp`
repository:

    scripts/kconfig/merge_config.sh \
        ~/repos/thesis/etc/ubuntu_14.02_4.2.0-27.config \
        ~/repos/thesis/etc/mptcp.frag \
        ~/repos/thesis/etc/mininet.frag
